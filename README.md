# üö´ AntiSpam Bot

–ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–π Telegram –±–æ—Ç –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ [tg-spam](https://github.com/celjon/tg-spam).

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–ø–∞–º–∞:

### **1. –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (1-5ms)**
- –ê–Ω–∞–ª–∏–∑ —ç–º–æ–¥–∑–∏, –∑–∞–≥–ª–∞–≤–Ω—ã—Ö –±—É–∫–≤, —Å—Å—ã–ª–æ–∫
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å–ø–∞–º-–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- –¢–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å–ø–∞–º-—Ñ—Ä–∞–∑
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π

### **2. CAS (Combot Anti-Spam) (10-50ms)**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–ø–∞–º–µ—Ä–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Redis
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CSV —ç–∫—Å–ø–æ—Ä—Ç–∞

### **3. ML –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä (100-500ms)**
- BERT –º–æ–¥–µ–ª—å `RUSpam/spamNS_v1` –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- Fallback –Ω–∞ sklearn –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞

### **4. OpenAI –∞–Ω–∞–ª–∏–∑ (1-3s)**
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- Veto mode –¥–ª—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤
- –ê–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### **5. –ê–Ω—Å–∞–º–±–ª–µ–≤—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä**
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–ª–æ–µ–≤
- –†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å–ø–∞–º–∞
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –≤–µ—Å–∞–º–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Python 3.8+
- PostgreSQL
- Redis
- OpenAI API –∫–ª—é—á (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### **–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/celjon/py-sp.git
cd py-sp

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp env.example .env
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º .env —Ñ–∞–π–ª

# –ó–∞–ø—É—Å–∫–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
alembic upgrade head

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
python src/main.py
```

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example`:

```env
# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token
ADMIN_CHAT_ID=-1001234567890
ADMIN_USERS=123456789,987654321

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://user:password@localhost:5432/dbname

# Redis
REDIS_URL=redis://localhost:6379/0

# OpenAI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
OPENAI_API_KEY=your_openai_key
OPENAI_MODEL=gpt-4o-mini

# CAS API
CAS_API_URL=https://api.cas.chat
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:**
```bash
python test_bot_simple.py
```

### **–¢–µ—Å—Ç CAS API:**
```bash
python test_cas_real.py
```

## üìä –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –°–ª–æ–π | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç—ã |
|------|--------|-------|
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç |
| **–î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏** | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞** | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç |
| **–≠–≤—Ä–∏—Å—Ç–∏–∫–∏** | ‚úÖ | 5/6 —Ç–µ—Å—Ç–æ–≤ |
| **CAS API** | ‚úÖ | 2/2 —Ç–µ—Å—Ç–∞ |
| **ML –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä** | ‚ùå | –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ |
| **OpenAI –¥–µ—Ç–µ–∫—Ç–æ—Ä** | ‚ùå | 3/4 —Ç–µ—Å—Ç–∞ |
| **–ê–Ω—Å–∞–º–±–ª–µ–≤—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä** | ‚ùå | –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ |

## üéØ –ê–¥–º–∏–Ω –∫–æ–º–∞–Ω–¥—ã

- `/ban` - –ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/approve` - –û–¥–æ–±—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/spam` - –ü–æ–º–µ—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ —Å–ø–∞–º
- `/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```
src/
‚îú‚îÄ‚îÄ adapter/          # –ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ delivery/         # –î–æ—Å—Ç–∞–≤–∫–∞ (Telegram, HTTP)
‚îú‚îÄ‚îÄ domain/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ lib/              # –£—Ç–∏–ª–∏—Ç—ã –∏ –∫–ª–∏–µ–Ω—Ç—ã
‚îî‚îÄ‚îÄ main.py           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞:**
1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å –≤ `src/domain/service/detector/`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ `detect()`
3. –î–æ–±–∞–≤—å—Ç–µ –≤ –∞–Ω—Å–∞–º–±–ª–µ–≤—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä
4. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–≠–≤—Ä–∏—Å—Ç–∏–∫–∏:** 1-5ms
- **CAS:** 10-50ms
- **ML:** 100-500ms
- **OpenAI:** 1-3s
- **–û–±—â–µ–µ –≤—Ä–µ–º—è:** 5-10ms –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è —Ñ–∏—á–∏
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE)

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- [tg-spam](https://github.com/celjon/tg-spam) - –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [CAS](https://cas.chat/) - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–ø–∞–º–µ—Ä–æ–≤
- [OpenAI](https://openai.com/) - AI –∞–Ω–∞–ª–∏–∑
- [Hugging Face](https://huggingface.co/) - ML –º–æ–¥–µ–ª–∏